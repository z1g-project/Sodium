(()=>{var ee=Object.create;var U=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var re=Object.getOwnPropertyNames;var se=Object.getPrototypeOf,oe=Object.prototype.hasOwnProperty;var ae=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports);var ne=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of re(e))!oe.call(o,s)&&s!==t&&U(o,s,{get:()=>e[s],enumerable:!(r=te(e,s))||r.enumerable});return o};var ie=(o,e,t)=>(t=o!=null?ee(se(o)):{},ne(e||!o||!o.__esModule?U(t,"default",{value:o,enumerable:!0}):t,o));var J=ae((Pe,v)=>{"use strict";var g={decodeValues:!0,map:!1,silent:!1};function A(o){return typeof o=="string"&&!!o.trim()}function W(o,e){var t=o.split(";").filter(A),r=t.shift(),s=xe(r),i=s.name,n=s.value;e=e?Object.assign({},g,e):g;try{n=e.decodeValues?decodeURIComponent(n):n}catch(d){console.error("set-cookie-parser encountered an error while decoding a cookie with value '"+n+"'. Set options.decodeValues to false to disable this feature.",d)}var a={name:i,value:n};return t.forEach(function(d){var l=d.split("="),p=l.shift().trimLeft().toLowerCase(),h=l.join("=");p==="expires"?a.expires=new Date(h):p==="max-age"?a.maxAge=parseInt(h,10):p==="secure"?a.secure=!0:p==="httponly"?a.httpOnly=!0:p==="samesite"?a.sameSite=h:a[p]=h}),a}function xe(o){var e="",t="",r=o.split("=");return r.length>1?(e=r.shift(),t=r.join("=")):t=o,{name:e,value:t}}function V(o,e){if(e=e?Object.assign({},g,e):g,!o)return e.map?{}:[];if(o.headers)if(typeof o.headers.getSetCookie=="function")o=o.headers.getSetCookie();else if(o.headers["set-cookie"])o=o.headers["set-cookie"];else{var t=o.headers[Object.keys(o.headers).find(function(s){return s.toLowerCase()==="set-cookie"})];!t&&o.headers.cookie&&!e.silent&&console.warn("Warning: set-cookie-parser appears to have been called on a request object. It is designed to parse Set-Cookie headers from responses, not Cookie headers from requests. Set the option {silent: true} to suppress this warning."),o=t}if(Array.isArray(o)||(o=[o]),e=e?Object.assign({},g,e):g,e.map){var r={};return o.filter(A).reduce(function(s,i){var n=W(i,e);return s[n.name]=n,s},r)}else return o.filter(A).map(function(s){return W(s,e)})}function ve(o){if(Array.isArray(o))return o;if(typeof o!="string")return[];var e=[],t=0,r,s,i,n,a;function d(){for(;t<o.length&&/\s/.test(o.charAt(t));)t+=1;return t<o.length}function l(){return s=o.charAt(t),s!=="="&&s!==";"&&s!==","}for(;t<o.length;){for(r=t,a=!1;d();)if(s=o.charAt(t),s===","){for(i=t,t+=1,d(),n=t;t<o.length&&l();)t+=1;t<o.length&&o.charAt(t)==="="?(a=!0,t=n,e.push(o.substring(r,i)),r=t):t=i+1}else t+=1;(!a||t>=o.length)&&e.push(o.substring(r,o.length))}return e}v.exports=V;v.exports.parse=V;v.exports.parseString=W;v.exports.splitCookiesString=ve});var ce=globalThis.fetch,f=globalThis.WebSocket,le=globalThis.Request,P=globalThis.Response,E=globalThis.SharedWorker,I=globalThis.localStorage,de=globalThis.navigator.serviceWorker,y={prototype:{send:f.prototype.send},CLOSED:f.CLOSED,CLOSING:f.CLOSING,CONNECTING:f.CONNECTING,OPEN:f.OPEN};async function R(){let e=(await self.clients.matchAll({type:"window",includeUncontrolled:!0})).map(async r=>{let s=await pe(r);return await G(s),s}),t=Promise.race([Promise.any(e),new Promise((r,s)=>setTimeout(s,1e3,new TypeError("timeout")))]);try{return await t}catch(r){if(r instanceof AggregateError)throw console.error("bare-mux: failed to get a bare-mux SharedWorker MessagePort as all clients returned an invalid MessagePort."),new Error("All clients returned an invalid MessagePort.");return console.warn("bare-mux: failed to get a bare-mux SharedWorker MessagePort within 1s, retrying"),await R()}}function pe(o){let e=new MessageChannel;return new Promise(t=>{o.postMessage({type:"getPort",port:e.port2},[e.port2]),e.port1.onmessage=r=>{t(r.data)}})}function G(o){let e=new MessageChannel,t=new Promise((r,s)=>{e.port1.onmessage=i=>{i.data.type==="pong"&&r()},setTimeout(s,1500)});return o.postMessage({message:{type:"ping"},port:e.port2},[e.port2]),t}function B(o,e){let t=new E(o,"bare-mux-worker");return e&&de.addEventListener("message",r=>{if(r.data.type==="getPort"&&r.data.port){console.debug("bare-mux: recieved request for port from sw");let s=new E(o,"bare-mux-worker");r.data.port.postMessage(s.port,[s.port])}}),t.port}var M=class{constructor(e){this.channel=new BroadcastChannel("bare-mux"),e instanceof MessagePort?this.port=e:this.createChannel(e,!0)}createChannel(e,t){if(self.clients)this.port=R(),this.channel.onmessage=r=>{r.data.type==="refreshPort"&&(this.port=R())};else if(e&&E){if(!e.startsWith("/")&&!e.includes("://"))throw new Error("Invalid URL. Must be absolute or start at the root.");this.port=B(e,t),console.debug("bare-mux: setting localStorage bare-mux-path to",e),I["bare-mux-path"]=e}else if(E){let r=I["bare-mux-path"];if(console.debug("bare-mux: got localStorage bare-mux-path:",r),!r)throw new Error("Unable to get bare-mux workerPath from localStorage.");this.port=B(r,t)}else throw new Error("Unable to get a channel to the SharedWorker.")}async sendMessage(e,t){this.port instanceof Promise&&(this.port=await this.port);try{await G(this.port)}catch{return console.warn("bare-mux: Failed to get a ping response from the worker within 1.5s. Assuming port is dead."),this.createChannel(),await this.sendMessage(e,t)}let r=new MessageChannel,s=[r.port2,...t||[]],i=new Promise((n,a)=>{r.port1.onmessage=d=>{let l=d.data;l.type==="error"?a(l.error):n(l)}});return this.port.postMessage({message:e,port:r.port2},s),await i}},he="!#$%&'*+-.0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ^_`abcdefghijklmnopqrstuvwxyz|~";function fe(o){for(let e=0;e<o.length;e++){let t=o[e];if(!he.includes(t))return!1}return!0}var ue=["ws:","wss:"],me=[101,204,205,304],ge=[301,302,303,307,308];var S=class{constructor(e){this.worker=new M(e)}createWebSocket(e,t=[],r,s,i){try{e=new URL(e)}catch{throw new DOMException(`Faiiled to construct 'WebSocket': The URL '${e}' is invalid.`)}if(!ue.includes(e.protocol))throw new DOMException(`Failed to construct 'WebSocket': The URL's scheme must be either 'ws' or 'wss'. '${e.protocol}' is not allowed.`);Array.isArray(t)||(t=[t]),t=t.map(String);for(let c of t)if(!fe(c))throw new DOMException(`Failed to construct 'WebSocket': The subprotocol '${c}' is invalid.`);let n=r||f,a=new n("ws://127.0.0.1:1",t),d="",l=y.CONNECTING,p=!1;a.addEventListener("error",c=>{p||(l=f.CONNECTING,c.stopImmediatePropagation(),p=!0)});let h=!1;a.addEventListener("close",c=>{h||(c.stopImmediatePropagation(),h=!0)}),i=i||n.constructor.constructor("return ArrayBuffer")().prototype,s=s||{},s.Host=new URL(e).host,s.Pragma="no-cache",s["Cache-Control"]="no-cache",s.Upgrade="websocket",s.Connection="Upgrade";let k=c=>{l=y.OPEN,d=c,a.meta={headers:{"sec-websocket-protocol":c}},a.dispatchEvent(new Event("open"))},Q=async c=>{typeof c=="string"?a.dispatchEvent(new MessageEvent("message",{data:c})):"byteLength"in c?(a.binaryType==="blob"?c=new Blob([c]):Object.setPrototypeOf(c,i),a.dispatchEvent(new MessageEvent("message",{data:c}))):"arrayBuffer"in c&&(a.binaryType==="arraybuffer"&&(c=await c.arrayBuffer(),Object.setPrototypeOf(c,i)),a.dispatchEvent(new MessageEvent("message",{data:c})))},X=(c,u)=>{l=y.CLOSED,a.dispatchEvent(new CloseEvent("close",{code:c,reason:u}))},Z=()=>{l=y.CLOSED,a.dispatchEvent(new Event("error"))},w=new MessageChannel;w.port1.onmessage=c=>{c.data.type==="open"?k(c.data.args[0]):c.data.type==="message"?Q(c.data.args[0]):c.data.type==="close"?X(c.data.args[0],c.data.args[1]):c.data.type==="error"&&Z()},this.worker.sendMessage({type:"websocket",websocket:{url:e.toString(),origin,protocols:t,requestHeaders:s,channel:w.port2}},[w.port2]);let F=()=>l;Object.defineProperty(a,"readyState",{get:F,configurable:!0,enumerable:!0});let q=()=>{if(F()===y.CONNECTING)return new DOMException("Failed to execute 'send' on 'WebSocket': Still in CONNECTING state.")};return a.send=function(...c){let u=q();if(u)throw u;let m=c[0];m.buffer&&(m=m.buffer),w.port1.postMessage({type:"data",data:m},m instanceof ArrayBuffer?[m]:[])},a.close=function(c,u){w.port1.postMessage({type:"close",closeCode:c,closeReason:u})},Object.defineProperty(a,"url",{get:()=>e.toString(),configurable:!0,enumerable:!0}),Object.defineProperty(a,"protocol",{get:()=>d,configurable:!0,enumerable:!0}),a}async fetch(e,t){let r=new le(e,t),s=t?.headers||r.headers,i=s instanceof Headers?Object.fromEntries(s):s,n=r.body,a=new URL(r.url);if(a.protocol.startsWith("blob:")){let d=await ce(a),l=new P(d.body,d);return l.rawHeaders=Object.fromEntries(d.headers),l.rawResponse=d,l}for(let d=0;;d++){"host"in i?i.host=a.host:i.Host=a.host;let l=(await this.worker.sendMessage({type:"fetch",fetch:{remote:a.toString(),method:r.method,headers:i,body:n||void 0}},n?[n]:[])).fetch,p=new P(me.includes(l.status)?void 0:l.body,{headers:new Headers(l.headers),status:l.status,statusText:l.statusText});p.rawHeaders=l.headers,p.rawResponse=new P(l.body),p.finalURL=a.toString();let h=t?.redirect||r.redirect;if(ge.includes(p.status))switch(h){case"follow":{let k=p.headers.get("location");if(20>d&&k!==null){a=new URL(k,a);continue}else throw new TypeError("Failed to fetch")}case"error":throw new TypeError("Failed to fetch");case"manual":return p}else return p}}};var H="1.0.5";var{assign:N}=Object,j="entries",C="readonly",$="readwrite",L={durability:"default",prefix:"IDBMap"},b=({target:{result:o}})=>o,x=class extends EventTarget{#t;#s;#r;async#e(e,t){let s=(await this.#t).transaction(j,t,this.#s);return new Promise((i,n)=>N(e(s.objectStore(j)),{onsuccess:i,onerror:n}))}constructor(e,{durability:t=L.durability,prefix:r=L.prefix}=L){super(),this.#r=r,this.#s={durability:t},this.#t=new Promise((s,i)=>{N(indexedDB.open(`${this.#r}/${e}`),{onupgradeneeded({target:{result:n,transaction:a}}){n.objectStoreNames.length||n.createObjectStore(j),a.oncomplete=()=>s(n)},onsuccess(n){s(b(n))},onerror(n){i(n),this.dispatchEvent(n)}})}).then(s=>{let i=this.dispatchEvent.bind(this);for(let n in s)n.startsWith("on")&&(s[n]=i);return s})}dispatchEvent(e){let{type:t,message:r,isTrusted:s}=e;return super.dispatchEvent(s?N(new Event(t),{message:r}):e)}async close(){(await this.#t).close()}get size(){return this.#e(e=>e.count(),C).then(b)}async clear(){await this.#e(e=>e.clear(),$)}async delete(e){await this.#e(t=>t.delete(e),$)}async entries(){let e=await this.keys();return Promise.all(e.map(t=>this.get(t).then(r=>[t,r])))}async forEach(e,t=this){for(let[r,s]of await this.entries())await e.call(t,s,r,this)}async get(e){return await this.#e(r=>r.get(e),C).then(b)}async has(e){return await this.#e(r=>r.getKey(e),C).then(b)!==void 0}async keys(){return await this.#e(t=>t.getAllKeys(),C).then(b)}async set(e,t){return await this.#e(r=>r.put(t,e),$),this}async values(){let e=await this.keys();return Promise.all(e.map(t=>this.get(t)))}get[Symbol.toStringTag](){return this.#r}};var T=/^[\u0009\u0020-\u007E\u0080-\u00FF]+$/;function z(o,e,t){let r=t||{},s=r.encode||be;if(typeof s!="function")throw new TypeError("option encode is invalid");if(!T.test(o))throw new TypeError("argument name is invalid");let i=s(e);if(i&&!T.test(i))throw new TypeError("argument val is invalid");let n=o+"="+i;if(r.maxAge!==void 0&&r.maxAge!==null){let a=r.maxAge-0;if(Number.isNaN(a)||!Number.isFinite(a))throw new TypeError("option maxAge is invalid");n+="; Max-Age="+Math.floor(a)}if(r.domain){if(!T.test(r.domain))throw new TypeError("option domain is invalid");n+="; Domain="+r.domain}if(r.path){if(!T.test(r.path))throw new TypeError("option path is invalid");n+="; Path="+r.path}if(r.expires){if(!ye(r.expires)||Number.isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");n+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(n+="; HttpOnly"),r.secure&&(n+="; Secure"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():r.priority){case"low":{n+="; Priority=Low";break}case"medium":{n+="; Priority=Medium";break}case"high":{n+="; Priority=High";break}default:throw new TypeError("option priority is invalid")}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:{n+="; SameSite=Strict";break}case"lax":{n+="; SameSite=Lax";break}case"strict":{n+="; SameSite=Strict";break}case"none":{n+="; SameSite=None";break}default:throw new TypeError("option sameSite is invalid")}return r.partitioned&&(n+="; Partitioned"),n}function ye(o){return Object.prototype.toString.call(o)==="[object Date]"||o instanceof Date}function be(o){return encodeURIComponent(o)}var K=ie(J(),1),O=new x("cookies");async function Y(o){let e=new Date,t=[];for(let s of await O.keys())if(s.startsWith(`${o}@`)){let i=!1,n=await O.get(s);n.maxAge?i=n.set.getTime()+n.maxAge*1e3<e:n.expires&&(i=new Date(n.expires.toLocaleString())<e),i?await O.delete(s):t.push(n)}return t.map(s=>z(s.name,s.value,s))}async function _(o,e){let t=(0,K.parse)(o);for(let r of t)await O.set(`${e}@${r.name}`,r.value)}var D=class{client;constructor(){this.client=new S}shouldRoute({request:e}){return e.url.startsWith(location.origin+self.$meteor.config.prefix)}async handleFetch({request:e}){try{let t=new URL(self.$meteor.rewrite.url.decode(e.url));self.$meteor.util.log(`Processing request for ${t.href}`);for(let a of self.$meteor.config.plugins)a.filter.test(t.href)&&self.$meteor.util.log(`Plugin ${a.name} loaded for this page`,"teal");if(t.href.startsWith("data:")){let a=await fetch(t);return new Response(a.body)}let r=new Headers(e.headers);r.set("cookie",(await Y(t.host)).join("; ")),r.set("host",t.host),r.set("origin",t.origin);let s=await this.client.fetch(t,{method:e.method,body:e.body,headers:r,credentials:"omit",mode:e.mode==="cors"?e.mode:"same-origin",cache:e.cache,redirect:e.redirect,duplex:"half"}),i,n=self.$meteor.rewrite.headers(s.headers,t);if(await _(s.rawHeaders["set-cookie"],t.host),s.body)switch(e.destination){case"iframe":case"frame":case"document":s.headers.get("content-type").includes("text/html")?i=self.$meteor.rewrite.html(await s.text(),t):i=s.body;break;case"style":i=self.$meteor.rewrite.css(await s.text(),t);break;case"worker":case"sharedworker":case"script":i=self.$meteor.rewrite.js(await s.text(),t);break;default:i=s.body}if(["document","iframe"].includes(e.destination)){let a=s.headers.get("content-disposition");if(!/\s*?((inline|attachment);\s*?)filename=/i.test(a)){let d=/^\s*?attachment/i.test(a)?"attachment":"inline",[l]=s.finalURL.split("/").reverse();s.headers.set("Content-Disposition",`${d}; filename=${JSON.stringify(l)}`)}}for(let a of self.$meteor.config.plugins)a.filter.test(t.href)&&"onRequest"in a&&(self.$meteor.util.log(`Running onRequest for ${a.name}`,"teal"),s=await a.onRequest(s));return new Response(i,{headers:n,status:s.status,statusText:s.statusText})}catch(t){self.$meteor.util.log(t,"#FF5757");let r=self.$meteor.rewrite.url.decode(e.url);return this.renderError(t,r,H)}}renderError(e,t,r){return new Response(`
        <!DOCTYPE html>
        <html lang="en">
          <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <script src="https://cdn.tailwindcss.com"><\/script>
            <title>Something went wrong</title>

          </head>
          <body>
            <div class="flex min-h-[100dvh] flex-col items-center justify-center bg-white px-4 py-12 sm:px-6 lg:px-8">
              <div class="mx-auto max-w-md text-center">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  class="mx-auto h-12 w-12 stroke-red-400"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"
                  ></path>
                </svg>
                <h1 class="mt-4 text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">
                  Something went wrong
                </h1>
                <p class="mt-4 text-gray-500">
                  Meteor ran into an error while processing your request.
                </p>
                <div class="mt-6 space-y-4">
                  <p class="mt-4 text-gray-500 text-left">URL: <span class="p-1.5 px-2 bg-gray-100 font-mono text-sm rounded-md">${t}</span></p>
                  <p class="mt-4 text-gray-500 text-left">Version: <span class="p-1.5 px-2 bg-gray-100 font-mono text-sm rounded-md">${r}</span></p>
                  <pre class="rounded-md bg-gray-100 p-4 text-left text-sm text-gray-500">${e}</pre>
                  <div class="flex space-x-2">
                    <button onclick="window.location.reload()" class="rounded-md border border-transparent bg-gray-800 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-gray-900 flex-1 transition-all">
                      Reload Page
                    </button>
                    <a href="https://github.com/meteorproxy/meteor/issues/new" target="_blank" class="rounded-md border-2 border-gray-800 px-4 py-2 text-sm font-medium text-gray-800 hover:bg-gray-800 hover:text-white flex-1 transition-all">
                      Report Error
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </body>
        </html>
      `,{status:500,headers:{"Content-Type":"text/html"}})}};self.MeteorServiceWorker=D;})();
//# sourceMappingURL=meteor.worker.js.map
